# Custom Data Serialization
## 1. Giới thiệu
- Custom Data Serialization là một cách để tùy chỉnh cách dữ liệu được trả về từ API. 
- Khi chúng ta trả về một object từ API, object đó sẽ được chuyển đổi thành một JSON object theo cấu trúc mặc định. Tuy nhiên, chúng ta có thể tùy chỉnh cách dữ liệu được trả về. Tránh trả về các trường dữ liệu không cần thiết, hoặc thay đổi cấu trúc dữ liệu trả về.

## 2. Nguyên lý hoạt động khi trả về dữ liệu từ API sử dụng Custom Data Serialization
- 1, Đầu tiên, người dùng gửi một `REQUEST` đến server.
- 2, `REQUEST` sẽ được xử lý bởi một `CONTROLLER`.
- 3, `CONTROLLER` sẽ gọi một `SERVICE` để xử lý logic.
- 4, `SERVICE` sẽ gọi một `REPOSITORY` để truy vấn dữ liệu từ database.
- 5, `REPOSITORY` sẽ trả về dữ liệu cho `SERVICE`.
- 6, `SERVICE` sẽ trả về dữ liệu cho `CONTROLLER`.
- 7, 
    + Bình thường nếu không sử dụng `Custom Data Serialization`, `CONTROLLER` sẽ trả về dữ liệu từ `SERVICE` mà không qua bất kỳ xử lý nào.
    + Khi sử dụng `Custom Data Serialization`, chúng ta sẽ tùy chỉnh cách dữ liệu được trả về từ `SERVICE` trước khi trả về cho `CONTROLLER` thông qua một `Class Serializer Interceptor`.
- 8, `Class Serializer Interceptor` sẽ chuyển đổi dữ liệu trả về từ `SERVICE` theo cấu trúc mà chúng ta đã tùy chỉnh sau đó trả về cho `CONTROLLER` rồi trả về cho người dùng.

## 3. Sử dụng class-transformer 
- `class-transformer` là một thư viện giúp chúng ta tùy chỉnh cách dữ liệu được trả về từ API.
- Để sử dụng `class-transformer`, chúng ta cần cài đặt thư viện này:
```bash
npm install class-transformer
```
- Sau đó, chúng ta tạo một class và sử dụng các decorator từ `class-transformer` để tùy chỉnh cách dữ liệu được trả về:
>> user.entity.ts
```typescript
import { Exclude, Expose } from 'class-transformer';

export class User {
  id: number;
  name: string;
  email: string;

  @Exclude() // Loại bỏ trường này khỏi dữ liệu trả về
  password: string;

  @Expose({ name: 'full_name' }) // Đổi tên trường này trong dữ liệu trả về
  fullName: string;
}
```
- Sau đó, thêm decorator `@UseInterceptors(ClassSerializerInterceptor)` vào `CONTROLLER` để sử dụng `Class Serializer Interceptor`:
>> user.controller.ts
```typescript
import { Controller, Get, UseInterceptors } from '@nestjs/common';
import { ClassSerializerInterceptor } from '@nestjs/common';
import { User } from './user.entity';

@Controller('users')
export class UserController {
  @Get()
  @UseInterceptors(ClassSerializerInterceptor) // Sử dụng Class Serializer Interceptor
  findAll() {
    return ...; // Trả về dữ liệu
  }
}
```
